#include <idt.h>
#include <memory.h>

struct idt_entry idt[256];
struct idt_ptr idtp;

void idt_set_gate(u8int num, u64int base, u16int sel, u8int flags)
{
    idt[num].sel = sel;
    idt[num].flags = flags;
    idt[num].always0 = 0;
    idt[num].base_lo = base & 0xFFFF;
    idt[num].base_hi = (base >> 16) & 0xFFFF;
}

void idt_install()
{
    idtp.limit = (sizeof(struct idt_entry) * 256) -1;
    idtp.base = (u32int) &idt;
    
    idt_set_gate(0, (u32int)isr0, 0x08, 0x8E);
    idt_set_gate(1, (u32int)isr1, 0x08, 0x8E);
    idt_set_gate(2, (u32int)isr2, 0x08, 0x8E);
    idt_set_gate(3, (u32int)isr3, 0x08, 0x8E);
    idt_set_gate(4, (u32int)isr4, 0x08, 0x8E);
    idt_set_gate(5, (u32int)isr5, 0x08, 0x8E);
    idt_set_gate(6, (u32int)isr6, 0x08, 0x8E);
    idt_set_gate(7, (u32int)isr7, 0x08, 0x8E);
    idt_set_gate(8, (u32int)isr8, 0x08, 0x8E);
    idt_set_gate(9, (u32int)isr9, 0x08, 0x8E);
    idt_set_gate(10, (u32int)isr10, 0x08, 0x8E);
    idt_set_gate(11, (u32int)isr11, 0x08, 0x8E);
    idt_set_gate(12, (u32int)isr12, 0x08, 0x8E);
    idt_set_gate(13, (u32int)isr13, 0x08, 0x8E);
    idt_set_gate(14, (u32int)isr14, 0x08, 0x8E);
    idt_set_gate(15, (u32int)isr15, 0x08, 0x8E);
    idt_set_gate(16, (u32int)isr16, 0x08, 0x8E);
    idt_set_gate(17, (u32int)isr17, 0x08, 0x8E);
    idt_set_gate(18, (u32int)isr18, 0x08, 0x8E);
    idt_set_gate(19, (u32int)isr19, 0x08, 0x8E);
    idt_set_gate(20, (u32int)isr20, 0x08, 0x8E);
    idt_set_gate(21, (u32int)isr21, 0x08, 0x8E);
    idt_set_gate(22, (u32int)isr22, 0x08, 0x8E);
    idt_set_gate(23, (u32int)isr23, 0x08, 0x8E);
    idt_set_gate(24, (u32int)isr24, 0x08, 0x8E);
    idt_set_gate(25, (u32int)isr25, 0x08, 0x8E);
    idt_set_gate(26, (u32int)isr26, 0x08, 0x8E);
    idt_set_gate(27, (u32int)isr27, 0x08, 0x8E);
    idt_set_gate(28, (u32int)isr28, 0x08, 0x8E);
    idt_set_gate(29, (u32int)isr29, 0x08, 0x8E);
    idt_set_gate(30, (u32int)isr30, 0x08, 0x8E);
    idt_set_gate(31, (u32int)isr31, 0x08, 0x8E);
/*
    idt_set_gate(32, (u32int)isr32, 0x08, 0x8E);
    idt_set_gate(33, (u32int)isr33, 0x08, 0x8E);
    idt_set_gate(34, (u32int)isr34, 0x08, 0x8E);
    idt_set_gate(35, (u32int)isr35, 0x08, 0x8E);
    idt_set_gate(36, (u32int)isr36, 0x08, 0x8E);
    idt_set_gate(37, (u32int)isr37, 0x08, 0x8E);
    idt_set_gate(38, (u32int)isr38, 0x08, 0x8E);
    idt_set_gate(39, (u32int)isr39, 0x08, 0x8E);
    idt_set_gate(40, (u32int)isr40, 0x08, 0x8E);
    idt_set_gate(41, (u32int)isr41, 0x08, 0x8E);
    idt_set_gate(42, (u32int)isr42, 0x08, 0x8E);
    idt_set_gate(43, (u32int)isr43, 0x08, 0x8E);
    idt_set_gate(44, (u32int)isr44, 0x08, 0x8E);
    idt_set_gate(45, (u32int)isr45, 0x08, 0x8E);
    idt_set_gate(46, (u32int)isr46, 0x08, 0x8E);
    idt_set_gate(47, (u32int)isr47, 0x08, 0x8E);
    idt_set_gate(48, (u32int)isr48, 0x08, 0x8E);
    idt_set_gate(49, (u32int)isr49, 0x08, 0x8E);
    idt_set_gate(50, (u32int)isr50, 0x08, 0x8E);
    idt_set_gate(51, (u32int)isr51, 0x08, 0x8E);
    idt_set_gate(52, (u32int)isr52, 0x08, 0x8E);
    idt_set_gate(53, (u32int)isr53, 0x08, 0x8E);
    idt_set_gate(54, (u32int)isr54, 0x08, 0x8E);
    idt_set_gate(55, (u32int)isr55, 0x08, 0x8E);
    idt_set_gate(56, (u32int)isr56, 0x08, 0x8E);
    idt_set_gate(57, (u32int)isr57, 0x08, 0x8E);
    idt_set_gate(58, (u32int)isr58, 0x08, 0x8E);
    idt_set_gate(59, (u32int)isr59, 0x08, 0x8E);
    idt_set_gate(60, (u32int)isr60, 0x08, 0x8E);
    idt_set_gate(61, (u32int)isr61, 0x08, 0x8E);
    idt_set_gate(62, (u32int)isr62, 0x08, 0x8E);
    idt_set_gate(63, (u32int)isr63, 0x08, 0x8E);
    idt_set_gate(64, (u32int)isr64, 0x08, 0x8E);
    idt_set_gate(65, (u32int)isr65, 0x08, 0x8E);
    idt_set_gate(66, (u32int)isr66, 0x08, 0x8E);
    idt_set_gate(67, (u32int)isr67, 0x08, 0x8E);
    idt_set_gate(68, (u32int)isr68, 0x08, 0x8E);
    idt_set_gate(69, (u32int)isr69, 0x08, 0x8E);
    idt_set_gate(70, (u32int)isr70, 0x08, 0x8E);
    idt_set_gate(71, (u32int)isr71, 0x08, 0x8E);
    idt_set_gate(72, (u32int)isr72, 0x08, 0x8E);
    idt_set_gate(73, (u32int)isr73, 0x08, 0x8E);
    idt_set_gate(74, (u32int)isr74, 0x08, 0x8E);
    idt_set_gate(75, (u32int)isr75, 0x08, 0x8E);
    idt_set_gate(76, (u32int)isr76, 0x08, 0x8E);
    idt_set_gate(77, (u32int)isr77, 0x08, 0x8E);
    idt_set_gate(78, (u32int)isr78, 0x08, 0x8E);
    idt_set_gate(79, (u32int)isr79, 0x08, 0x8E);
    idt_set_gate(80, (u32int)isr80, 0x08, 0x8E);
    idt_set_gate(81, (u32int)isr81, 0x08, 0x8E);
    idt_set_gate(82, (u32int)isr82, 0x08, 0x8E);
    idt_set_gate(83, (u32int)isr83, 0x08, 0x8E);
    idt_set_gate(84, (u32int)isr84, 0x08, 0x8E);
    idt_set_gate(85, (u32int)isr85, 0x08, 0x8E);
    idt_set_gate(86, (u32int)isr86, 0x08, 0x8E);
    idt_set_gate(87, (u32int)isr87, 0x08, 0x8E);
    idt_set_gate(88, (u32int)isr88, 0x08, 0x8E);
    idt_set_gate(89, (u32int)isr89, 0x08, 0x8E);
    idt_set_gate(90, (u32int)isr90, 0x08, 0x8E);
    idt_set_gate(91, (u32int)isr91, 0x08, 0x8E);
    idt_set_gate(92, (u32int)isr92, 0x08, 0x8E);
    idt_set_gate(93, (u32int)isr93, 0x08, 0x8E);
    idt_set_gate(94, (u32int)isr94, 0x08, 0x8E);
    idt_set_gate(95, (u32int)isr95, 0x08, 0x8E);
    idt_set_gate(96, (u32int)isr96, 0x08, 0x8E);
    idt_set_gate(97, (u32int)isr97, 0x08, 0x8E);
    idt_set_gate(98, (u32int)isr98, 0x08, 0x8E);
    idt_set_gate(99, (u32int)isr99, 0x08, 0x8E);
    idt_set_gate(100, (u32int)isr100, 0x08, 0x8E);
    idt_set_gate(101, (u32int)isr101, 0x08, 0x8E);
    idt_set_gate(102, (u32int)isr102, 0x08, 0x8E);
    idt_set_gate(103, (u32int)isr103, 0x08, 0x8E);
    idt_set_gate(104, (u32int)isr104, 0x08, 0x8E);
    idt_set_gate(105, (u32int)isr105, 0x08, 0x8E);
    idt_set_gate(106, (u32int)isr106, 0x08, 0x8E);
    idt_set_gate(107, (u32int)isr107, 0x08, 0x8E);
    idt_set_gate(108, (u32int)isr108, 0x08, 0x8E);
    idt_set_gate(109, (u32int)isr109, 0x08, 0x8E);
    idt_set_gate(110, (u32int)isr110, 0x08, 0x8E);
    idt_set_gate(111, (u32int)isr111, 0x08, 0x8E);
    idt_set_gate(112, (u32int)isr112, 0x08, 0x8E);
    idt_set_gate(113, (u32int)isr113, 0x08, 0x8E);
    idt_set_gate(114, (u32int)isr114, 0x08, 0x8E);
    idt_set_gate(115, (u32int)isr115, 0x08, 0x8E);
    idt_set_gate(116, (u32int)isr116, 0x08, 0x8E);
    idt_set_gate(117, (u32int)isr117, 0x08, 0x8E);
    idt_set_gate(118, (u32int)isr118, 0x08, 0x8E);
    idt_set_gate(119, (u32int)isr119, 0x08, 0x8E);
    idt_set_gate(120, (u32int)isr120, 0x08, 0x8E);
    idt_set_gate(121, (u32int)isr121, 0x08, 0x8E);
    idt_set_gate(122, (u32int)isr122, 0x08, 0x8E);
    idt_set_gate(123, (u32int)isr123, 0x08, 0x8E);
    idt_set_gate(124, (u32int)isr124, 0x08, 0x8E);
    idt_set_gate(125, (u32int)isr125, 0x08, 0x8E);
    idt_set_gate(126, (u32int)isr126, 0x08, 0x8E);
    idt_set_gate(127, (u32int)isr127, 0x08, 0x8E);
    idt_set_gate(128, (u32int)isr128, 0x08, 0x8E);
    idt_set_gate(129, (u32int)isr129, 0x08, 0x8E);
    idt_set_gate(130, (u32int)isr130, 0x08, 0x8E);
    idt_set_gate(131, (u32int)isr131, 0x08, 0x8E);
    idt_set_gate(132, (u32int)isr132, 0x08, 0x8E);
    idt_set_gate(133, (u32int)isr133, 0x08, 0x8E);
    idt_set_gate(134, (u32int)isr134, 0x08, 0x8E);
    idt_set_gate(135, (u32int)isr135, 0x08, 0x8E);
    idt_set_gate(136, (u32int)isr136, 0x08, 0x8E);
    idt_set_gate(137, (u32int)isr137, 0x08, 0x8E);
    idt_set_gate(138, (u32int)isr138, 0x08, 0x8E);
    idt_set_gate(139, (u32int)isr139, 0x08, 0x8E);
    idt_set_gate(140, (u32int)isr140, 0x08, 0x8E);
    idt_set_gate(141, (u32int)isr141, 0x08, 0x8E);
    idt_set_gate(142, (u32int)isr142, 0x08, 0x8E);
    idt_set_gate(143, (u32int)isr143, 0x08, 0x8E);
    idt_set_gate(144, (u32int)isr144, 0x08, 0x8E);
    idt_set_gate(145, (u32int)isr145, 0x08, 0x8E);
    idt_set_gate(146, (u32int)isr146, 0x08, 0x8E);
    idt_set_gate(147, (u32int)isr147, 0x08, 0x8E);
    idt_set_gate(148, (u32int)isr148, 0x08, 0x8E);
    idt_set_gate(149, (u32int)isr149, 0x08, 0x8E);
    idt_set_gate(150, (u32int)isr150, 0x08, 0x8E);
    idt_set_gate(151, (u32int)isr151, 0x08, 0x8E);
    idt_set_gate(152, (u32int)isr152, 0x08, 0x8E);
    idt_set_gate(153, (u32int)isr153, 0x08, 0x8E);
    idt_set_gate(154, (u32int)isr154, 0x08, 0x8E);
    idt_set_gate(155, (u32int)isr155, 0x08, 0x8E);
    idt_set_gate(156, (u32int)isr156, 0x08, 0x8E);
    idt_set_gate(157, (u32int)isr157, 0x08, 0x8E);
    idt_set_gate(158, (u32int)isr158, 0x08, 0x8E);
    idt_set_gate(159, (u32int)isr159, 0x08, 0x8E);
    idt_set_gate(160, (u32int)isr160, 0x08, 0x8E);
    idt_set_gate(161, (u32int)isr161, 0x08, 0x8E);
    idt_set_gate(162, (u32int)isr162, 0x08, 0x8E);
    idt_set_gate(163, (u32int)isr163, 0x08, 0x8E);
    idt_set_gate(164, (u32int)isr164, 0x08, 0x8E);
    idt_set_gate(165, (u32int)isr165, 0x08, 0x8E);
    idt_set_gate(166, (u32int)isr166, 0x08, 0x8E);
    idt_set_gate(167, (u32int)isr167, 0x08, 0x8E);
    idt_set_gate(168, (u32int)isr168, 0x08, 0x8E);
    idt_set_gate(169, (u32int)isr169, 0x08, 0x8E);
    idt_set_gate(170, (u32int)isr170, 0x08, 0x8E);
    idt_set_gate(171, (u32int)isr171, 0x08, 0x8E);
    idt_set_gate(172, (u32int)isr172, 0x08, 0x8E);
    idt_set_gate(173, (u32int)isr173, 0x08, 0x8E);
    idt_set_gate(174, (u32int)isr174, 0x08, 0x8E);
    idt_set_gate(175, (u32int)isr175, 0x08, 0x8E);
    idt_set_gate(176, (u32int)isr176, 0x08, 0x8E);
    idt_set_gate(177, (u32int)isr177, 0x08, 0x8E);
    idt_set_gate(178, (u32int)isr178, 0x08, 0x8E);
    idt_set_gate(179, (u32int)isr179, 0x08, 0x8E);
    idt_set_gate(180, (u32int)isr180, 0x08, 0x8E);
    idt_set_gate(181, (u32int)isr181, 0x08, 0x8E);
    idt_set_gate(182, (u32int)isr182, 0x08, 0x8E);
    idt_set_gate(183, (u32int)isr183, 0x08, 0x8E);
    idt_set_gate(184, (u32int)isr184, 0x08, 0x8E);
    idt_set_gate(185, (u32int)isr185, 0x08, 0x8E);
    idt_set_gate(186, (u32int)isr186, 0x08, 0x8E);
    idt_set_gate(187, (u32int)isr187, 0x08, 0x8E);
    idt_set_gate(188, (u32int)isr188, 0x08, 0x8E);
    idt_set_gate(189, (u32int)isr189, 0x08, 0x8E);
    idt_set_gate(190, (u32int)isr190, 0x08, 0x8E);
    idt_set_gate(191, (u32int)isr191, 0x08, 0x8E);
    idt_set_gate(192, (u32int)isr192, 0x08, 0x8E);
    idt_set_gate(193, (u32int)isr193, 0x08, 0x8E);
    idt_set_gate(194, (u32int)isr194, 0x08, 0x8E);
    idt_set_gate(195, (u32int)isr195, 0x08, 0x8E);
    idt_set_gate(196, (u32int)isr196, 0x08, 0x8E);
    idt_set_gate(197, (u32int)isr197, 0x08, 0x8E);
    idt_set_gate(198, (u32int)isr198, 0x08, 0x8E);
    idt_set_gate(199, (u32int)isr199, 0x08, 0x8E);
    idt_set_gate(200, (u32int)isr200, 0x08, 0x8E);
    idt_set_gate(201, (u32int)isr201, 0x08, 0x8E);
    idt_set_gate(202, (u32int)isr202, 0x08, 0x8E);
    idt_set_gate(203, (u32int)isr203, 0x08, 0x8E);
    idt_set_gate(204, (u32int)isr204, 0x08, 0x8E);
    idt_set_gate(205, (u32int)isr205, 0x08, 0x8E);
    idt_set_gate(206, (u32int)isr206, 0x08, 0x8E);
    idt_set_gate(207, (u32int)isr207, 0x08, 0x8E);
    idt_set_gate(208, (u32int)isr208, 0x08, 0x8E);
    idt_set_gate(209, (u32int)isr209, 0x08, 0x8E);
    idt_set_gate(210, (u32int)isr210, 0x08, 0x8E);
    idt_set_gate(211, (u32int)isr211, 0x08, 0x8E);
    idt_set_gate(212, (u32int)isr212, 0x08, 0x8E);
    idt_set_gate(213, (u32int)isr213, 0x08, 0x8E);
    idt_set_gate(214, (u32int)isr214, 0x08, 0x8E);
    idt_set_gate(215, (u32int)isr215, 0x08, 0x8E);
    idt_set_gate(216, (u32int)isr216, 0x08, 0x8E);
    idt_set_gate(217, (u32int)isr217, 0x08, 0x8E);
    idt_set_gate(218, (u32int)isr218, 0x08, 0x8E);
    idt_set_gate(219, (u32int)isr219, 0x08, 0x8E);
    idt_set_gate(220, (u32int)isr220, 0x08, 0x8E);
    idt_set_gate(221, (u32int)isr221, 0x08, 0x8E);
    idt_set_gate(222, (u32int)isr222, 0x08, 0x8E);
    idt_set_gate(223, (u32int)isr223, 0x08, 0x8E);
    idt_set_gate(224, (u32int)isr224, 0x08, 0x8E);
    idt_set_gate(225, (u32int)isr225, 0x08, 0x8E);
    idt_set_gate(226, (u32int)isr226, 0x08, 0x8E);
    idt_set_gate(227, (u32int)isr227, 0x08, 0x8E);
    idt_set_gate(228, (u32int)isr228, 0x08, 0x8E);
    idt_set_gate(229, (u32int)isr229, 0x08, 0x8E);
    idt_set_gate(230, (u32int)isr230, 0x08, 0x8E);
    idt_set_gate(231, (u32int)isr231, 0x08, 0x8E);
    idt_set_gate(232, (u32int)isr232, 0x08, 0x8E);
    idt_set_gate(233, (u32int)isr233, 0x08, 0x8E);
    idt_set_gate(234, (u32int)isr234, 0x08, 0x8E);
    idt_set_gate(235, (u32int)isr235, 0x08, 0x8E);
    idt_set_gate(236, (u32int)isr236, 0x08, 0x8E);
    idt_set_gate(237, (u32int)isr237, 0x08, 0x8E);
    idt_set_gate(238, (u32int)isr238, 0x08, 0x8E);
    idt_set_gate(239, (u32int)isr239, 0x08, 0x8E);
    idt_set_gate(240, (u32int)isr240, 0x08, 0x8E);
    idt_set_gate(241, (u32int)isr241, 0x08, 0x8E);
    idt_set_gate(242, (u32int)isr242, 0x08, 0x8E);
    idt_set_gate(243, (u32int)isr243, 0x08, 0x8E);
    idt_set_gate(244, (u32int)isr244, 0x08, 0x8E);
    idt_set_gate(245, (u32int)isr245, 0x08, 0x8E);
    idt_set_gate(246, (u32int)isr246, 0x08, 0x8E);
    idt_set_gate(247, (u32int)isr247, 0x08, 0x8E);
    idt_set_gate(248, (u32int)isr248, 0x08, 0x8E);
    idt_set_gate(249, (u32int)isr249, 0x08, 0x8E);
    idt_set_gate(250, (u32int)isr250, 0x08, 0x8E);
    idt_set_gate(251, (u32int)isr251, 0x08, 0x8E);
    idt_set_gate(252, (u32int)isr252, 0x08, 0x8E);
    idt_set_gate(253, (u32int)isr253, 0x08, 0x8E);
    idt_set_gate(254, (u32int)isr254, 0x08, 0x8E);
    idt_set_gate(255, (u32int)isr255, 0x08, 0x8E);
*/

    
    kmemset((void*) &idt, 0, sizeof(struct idt_entry) * 256);
    
    idt_load();
}
